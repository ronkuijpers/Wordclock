<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Wordclock Logs</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-100 text-gray-800 font-sans">
  <div class="max-w-2xl mx-auto p-4">
    <header class="flex items-center justify-between mb-6">
      <div>
        <h1 class="text-3xl font-bold">ðŸ“„ Logs</h1>
        <p class="text-sm text-gray-600">Download archived log files</p>
      </div>
      <div class="flex items-center gap-4">
        <a href="/admin.html" class="text-sm text-blue-600 hover:underline">Back to admin</a>
        <a href="/adminlogout" class="text-sm text-gray-600 hover:underline">Logout</a>
      </div>
    </header>

    <section class="bg-white p-4 rounded-2xl shadow">
      <div class="flex items-center justify-between">
        <h2 class="text-xl font-semibold">Available log files</h2>
        <button id="refreshLogs" class="text-sm text-blue-600 hover:underline">Refresh</button>
      </div>
      <p class="text-xs text-gray-500 mb-4">Newest entries first. Click to download.</p>
      <ul id="logList" class="space-y-2 text-sm text-gray-700"></ul>
      <p id="logError" class="text-xs text-red-600 mt-2"></p>
    </section>
  </div>

  <script>
    const listEl = document.getElementById('logList');
    const errEl = document.getElementById('logError');
    const btn = document.getElementById('refreshLogs');

    async function loadLogs() {
      if (errEl) errEl.textContent = '';
      if (listEl) listEl.innerHTML = '<li class="text-sm text-gray-500">Loadingâ€¦</li>';
      try {
        const res = await fetch('/api/logs');
        if (!res.ok) throw new Error('HTTP ' + res.status);
        const files = await res.json();
        if (!Array.isArray(files) || files.length === 0) {
          if (listEl) listEl.innerHTML = '<li class="text-sm text-gray-500">No logs available.</li>';
          return;
        }
        if (listEl) {
          listEl.innerHTML = '';
          files.forEach(file => {
            const li = document.createElement('li');
            li.className = 'flex items-center justify-between bg-gray-50 rounded px-3 py-2';
            const label = document.createElement('span');
            label.textContent = file.name + (file.size ? ` (${file.size} bytes)` : '');
            li.appendChild(label);
            const link = document.createElement('a');
            link.href = '/log/download?date=' + encodeURIComponent(file.date);
            link.className = 'text-blue-600 hover:underline';
            link.textContent = 'Download';
            li.appendChild(link);
            listEl.appendChild(li);
          });
        }
      } catch (err) {
        if (errEl) errEl.textContent = 'Failed to load logs (' + err.message + ')';
        if (listEl) listEl.innerHTML = '';
      }
    }

    if (btn) btn.addEventListener('click', loadLogs);
    loadLogs();
  </script>
</body>
</html>
